#!/bin/sh

set -e

cmd_close()
{
	sudo udisks --unmount /dev/disk/by-id/dm-name-sdb1-crypt
	sudo cryptsetup luksClose sdb1-crypt
}

cmd_open()
{
	gpg -d $HOME/key.gpg | sudo cryptsetup --key-file=- luksOpen /dev/sdb1 sdb1-crypt
	sudo udisks --mount /dev/disk/by-id/dm-name-sdb1-crypt
}

case "$1" in
close|open)
	command=$1
	;;
*)
	echo "Usage: $0 {close|open}" >&2
	exit 3
	;;
esac
shift

"cmd_$command" "$@"
